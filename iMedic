{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "3b3e0a12",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:24:38.677782Z",
     "iopub.status.busy": "2025-11-23T23:24:38.677469Z",
     "iopub.status.idle": "2025-11-23T23:24:38.858437Z",
     "shell.execute_reply": "2025-11-23T23:24:38.857382Z"
    },
    "papermill": {
     "duration": 0.189785,
     "end_time": "2025-11-23T23:24:38.860174",
     "exception": false,
     "start_time": "2025-11-23T23:24:38.670389",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Gemini API key setup complete.\n"
     ]
    }
   ],
   "source": [
    "import os\n",
    "from kaggle_secrets import UserSecretsClient\n",
    "\n",
    "try:\n",
    "    GOOGLE_API_KEY = UserSecretsClient().get_secret(\"GOOGLE_API_KEY\")\n",
    "    os.environ[\"GOOGLE_API_KEY\"] = GOOGLE_API_KEY\n",
    "    print(\"‚úÖ Gemini API key setup complete.\")\n",
    "except Exception as e:\n",
    "    print(\n",
    "        f\"üîë Authentication Error: Please make sure you have added 'GOOGLE_API_KEY' to your Kaggle secrets. Details: {e}\"\n",
    "    )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "dcc33fb4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:24:38.871537Z",
     "iopub.status.busy": "2025-11-23T23:24:38.871218Z",
     "iopub.status.idle": "2025-11-23T23:25:33.508579Z",
     "shell.execute_reply": "2025-11-23T23:25:33.507455Z"
    },
    "papermill": {
     "duration": 54.649625,
     "end_time": "2025-11-23T23:25:33.514780",
     "exception": false,
     "start_time": "2025-11-23T23:24:38.865155",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ ADK components imported successfully.\n"
     ]
    }
   ],
   "source": [
    "from google.adk.agents import Agent\n",
    "from google.adk.models.google_llm import Gemini\n",
    "from google.adk.runners import InMemoryRunner\n",
    "from google.adk.tools import google_search, AgentTool, ToolContext\n",
    "from google.genai import types\n",
    "from google.adk.agents import LlmAgent\n",
    "from google.adk.sessions import InMemorySessionService\n",
    "\n",
    "print(\"‚úÖ ADK components imported successfully.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "7e5ac063",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:33.526782Z",
     "iopub.status.busy": "2025-11-23T23:25:33.525208Z",
     "iopub.status.idle": "2025-11-23T23:25:33.533620Z",
     "shell.execute_reply": "2025-11-23T23:25:33.532380Z"
    },
    "papermill": {
     "duration": 0.015947,
     "end_time": "2025-11-23T23:25:33.535300",
     "exception": false,
     "start_time": "2025-11-23T23:25:33.519353",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ ADK components imported successfully.\n"
     ]
    }
   ],
   "source": [
    "import uuid\n",
    "from google.genai import types\n",
    "\n",
    "from google.adk.agents import LlmAgent\n",
    "from google.adk.models.google_llm import Gemini\n",
    "from google.adk.runners import Runner\n",
    "from google.adk.sessions import InMemorySessionService\n",
    "\n",
    "from google.adk.tools.mcp_tool.mcp_toolset import McpToolset\n",
    "from google.adk.tools.tool_context import ToolContext\n",
    "from google.adk.tools.mcp_tool.mcp_session_manager import StdioConnectionParams\n",
    "from mcp import StdioServerParameters\n",
    "\n",
    "from google.adk.apps.app import App, ResumabilityConfig\n",
    "from google.adk.tools.function_tool import FunctionTool\n",
    "\n",
    "print(\"‚úÖ ADK components imported successfully.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "a82ec4e3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:33.546639Z",
     "iopub.status.busy": "2025-11-23T23:25:33.546310Z",
     "iopub.status.idle": "2025-11-23T23:25:34.429743Z",
     "shell.execute_reply": "2025-11-23T23:25:34.428367Z"
    },
    "papermill": {
     "duration": 0.891362,
     "end_time": "2025-11-23T23:25:34.431447",
     "exception": false,
     "start_time": "2025-11-23T23:25:33.540085",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Helper functions defined.\n"
     ]
    }
   ],
   "source": [
    "# Define helper functions that will be reused throughout the notebook\n",
    "\n",
    "from IPython.core.display import display, HTML\n",
    "from jupyter_server.serverapp import list_running_servers\n",
    "\n",
    "\n",
    "# Gets the proxied URL in the Kaggle Notebooks environment\n",
    "def get_adk_proxy_url():\n",
    "    PROXY_HOST = \"https://kkb-production.jupyter-proxy.kaggle.net\"\n",
    "    ADK_PORT = \"8000\"\n",
    "\n",
    "    servers = list(list_running_servers())\n",
    "    if not servers:\n",
    "        raise Exception(\"No running Jupyter servers found.\")\n",
    "\n",
    "    baseURL = servers[0][\"base_url\"]\n",
    "\n",
    "    try:\n",
    "        path_parts = baseURL.split(\"/\")\n",
    "        kernel = path_parts[2]\n",
    "        token = path_parts[3]\n",
    "    except IndexError:\n",
    "        raise Exception(f\"Could not parse kernel/token from base URL: {baseURL}\")\n",
    "\n",
    "    url_prefix = f\"/k/{kernel}/{token}/proxy/proxy/{ADK_PORT}\"\n",
    "    url = f\"{PROXY_HOST}{url_prefix}\"\n",
    "\n",
    "    styled_html = f\"\"\"\n",
    "    <div style=\"padding: 15px; border: 2px solid #f0ad4e; border-radius: 8px; background-color: #fef9f0; margin: 20px 0;\">\n",
    "        <div style=\"font-family: sans-serif; margin-bottom: 12px; color: #333; font-size: 1.1em;\">\n",
    "            <strong>‚ö†Ô∏è IMPORTANT: Action Required</strong>\n",
    "        </div>\n",
    "        <div style=\"font-family: sans-serif; margin-bottom: 15px; color: #333; line-height: 1.5;\">\n",
    "            The ADK web UI is <strong>not running yet</strong>. You must start it in the next cell.\n",
    "            <ol style=\"margin-top: 10px; padding-left: 20px;\">\n",
    "                <li style=\"margin-bottom: 5px;\"><strong>Run the next cell</strong> (the one with <code>!adk web ...</code>) to start the ADK web UI.</li>\n",
    "                <li style=\"margin-bottom: 5px;\">Wait for that cell to show it is \"Running\" (it will not \"complete\").</li>\n",
    "                <li>Once it's running, <strong>return to this button</strong> and click it to open the UI.</li>\n",
    "            </ol>\n",
    "            <em style=\"font-size: 0.9em; color: #555;\">(If you click the button before running the next cell, you will get a 500 error.)</em>\n",
    "        </div>\n",
    "        <a href='{url}' target='_blank' style=\"\n",
    "            display: inline-block; background-color: #1a73e8; color: white; padding: 10px 20px;\n",
    "            text-decoration: none; border-radius: 25px; font-family: sans-serif; font-weight: 500;\n",
    "            box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: all 0.2s ease;\">\n",
    "            Open ADK Web UI (after running cell below) ‚Üó\n",
    "        </a>\n",
    "    </div>\n",
    "    \"\"\"\n",
    "\n",
    "    display(HTML(styled_html))\n",
    "\n",
    "    return url_prefix\n",
    "\n",
    "\n",
    "print(\"‚úÖ Helper functions defined.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "04ce02a4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:34.442918Z",
     "iopub.status.busy": "2025-11-23T23:25:34.442254Z",
     "iopub.status.idle": "2025-11-23T23:25:34.447658Z",
     "shell.execute_reply": "2025-11-23T23:25:34.446627Z"
    },
    "papermill": {
     "duration": 0.013269,
     "end_time": "2025-11-23T23:25:34.449680",
     "exception": false,
     "start_time": "2025-11-23T23:25:34.436411",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "retry_config=types.HttpRetryOptions(\n",
    "    attempts=5,  # Maximum retry attempts\n",
    "    exp_base=7,  # Delay multiplier\n",
    "    initial_delay=1, # Initial delay before first retry (in seconds)\n",
    "    http_status_codes=[429, 500, 503, 504] # Retry on these HTTP errors\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "3199dd81",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:34.460964Z",
     "iopub.status.busy": "2025-11-23T23:25:34.460587Z",
     "iopub.status.idle": "2025-11-23T23:25:34.467093Z",
     "shell.execute_reply": "2025-11-23T23:25:34.466027Z"
    },
    "papermill": {
     "duration": 0.013984,
     "end_time": "2025-11-23T23:25:34.468560",
     "exception": false,
     "start_time": "2025-11-23T23:25:34.454576",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Root Agent defined.\n"
     ]
    }
   ],
   "source": [
    "iMedic = Agent(\n",
    "    name=\"iMedic\",\n",
    "    model=Gemini(\n",
    "        model=\"gemini-2.5-flash-lite\",\n",
    "        retry_options=retry_config\n",
    "    ),\n",
    "    description=\"A simple agent that can answer general questions.\",\n",
    "    instruction=\"You are a helpful assistant. Use Google Search for current info or if unsure.\",\n",
    "    tools=[google_search],\n",
    ")\n",
    "\n",
    "print(\"‚úÖ Root Agent defined.\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "17d806cd",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:34.480477Z",
     "iopub.status.busy": "2025-11-23T23:25:34.480107Z",
     "iopub.status.idle": "2025-11-23T23:25:34.490411Z",
     "shell.execute_reply": "2025-11-23T23:25:34.489188Z"
    },
    "papermill": {
     "duration": 0.018689,
     "end_time": "2025-11-23T23:25:34.492115",
     "exception": false,
     "start_time": "2025-11-23T23:25:34.473426",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "sucessfull\n",
      "{'status': 'success', 'message': 'Appointment booked successfully!', 'appointment': {'patient_name': 'John Doe', 'doctor_name': 'Dr. Rahim', 'date': '2025-01-10', 'time': '14:30', 'symptoms': 'Headache'}}\n"
     ]
    }
   ],
   "source": [
    "from datetime import datetime\n",
    "\n",
    "# Simple in-memory database (You can replace this with a real DB)\n",
    "appointments = []\n",
    "\n",
    "def book_doctor_appointment(patient_name: str,\n",
    "                            doctor_name: str,\n",
    "                            date: str,\n",
    "                            time: str,\n",
    "                            symptoms: str = \"\") -> dict:\n",
    "    \"\"\"\n",
    "    Book a doctor appointment with validation.\n",
    "    \n",
    "    Args:\n",
    "        patient_name (str): Name of the patient.\n",
    "        doctor_name (str): Name of the doctor.\n",
    "        date (str): Appointment date in YYYY-MM-DD format.\n",
    "        time (str): Appointment time in HH:MM (24hr) format.\n",
    "        symptoms (str): Optional - patient's symptoms.\n",
    "\n",
    "    Returns:\n",
    "        dict: Confirmation or error message.\n",
    "    \"\"\"\n",
    "\n",
    "    # Validate date\n",
    "    try:\n",
    "        appointment_date = datetime.strptime(date, \"%Y-%m-%d\").date()\n",
    "    except ValueError:\n",
    "        return {\"status\": \"error\", \"message\": \"Invalid date format. Use YYYY-MM-DD\"}\n",
    "\n",
    "    # Validate time\n",
    "    try:\n",
    "        appointment_time = datetime.strptime(time, \"%H:%M\").time()\n",
    "    except ValueError:\n",
    "        return {\"status\": \"error\", \"message\": \"Invalid time format. Use HH:MM (24hr)\"}\n",
    "\n",
    "    # Check if time slot is already booked\n",
    "    for appt in appointments:\n",
    "        if (appt[\"doctor_name\"].lower() == doctor_name.lower() and\n",
    "            appt[\"date\"] == date and\n",
    "            appt[\"time\"] == time):\n",
    "            return {\n",
    "                \"status\": \"error\",\n",
    "                \"message\": f\"Doctor {doctor_name} is already booked at {time} on {date}.\"\n",
    "            }\n",
    "\n",
    "    # Save appointment\n",
    "    appointment = {\n",
    "        \"patient_name\": patient_name,\n",
    "        \"doctor_name\": doctor_name,\n",
    "        \"date\": date,\n",
    "        \"time\": time,\n",
    "        \"symptoms\": symptoms\n",
    "    }\n",
    "\n",
    "    appointments.append(appointment)\n",
    "\n",
    "    return {\n",
    "        \"status\": \"success\",\n",
    "        \"message\": \"Appointment booked successfully!\",\n",
    "        \"appointment\": appointment\n",
    "    }\n",
    "\n",
    "\n",
    "# Example usage:\n",
    "\n",
    "print(\"sucessfull\")\n",
    "print(book_doctor_appointment(\"John Doe\", \"Dr. Rahim\", \"2025-01-10\", \"14:30\", \"Headache\"))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "b43ecef5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:34.506338Z",
     "iopub.status.busy": "2025-11-23T23:25:34.505979Z",
     "iopub.status.idle": "2025-11-23T23:25:34.512967Z",
     "shell.execute_reply": "2025-11-23T23:25:34.511496Z"
    },
    "papermill": {
     "duration": 0.017438,
     "end_time": "2025-11-23T23:25:34.515030",
     "exception": false,
     "start_time": "2025-11-23T23:25:34.497592",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Doctor booking agent created with custom function tools\n",
      "üîß Available tools:\n"
     ]
    }
   ],
   "source": [
    "# booking agent with custom function tools\n",
    "booking_agent = LlmAgent(\n",
    "    name=\"booking_agent\",\n",
    "    model=Gemini(model=\"gemini-2.5-flash-lite\", retry_options=retry_config),\n",
    "    instruction=\"\"\"You are a smart booking agent assistant.\n",
    "\n",
    "    For currency conversion requests:\n",
    "    1. Use `book_doctor_appointment()` for booking\n",
    "    3. Check the \"status\" field in each tool's response for errors\n",
    "    4.If any tool returns status \"error\", explain the issue to the user clearly.\n",
    "    5. give the result json formet\n",
    "    6. after booking the appoinment give it json formet\n",
    "    \"\"\",\n",
    "    tools=[book_doctor_appointment],\n",
    ")\n",
    "\n",
    "print(\"‚úÖ Doctor booking agent created with custom function tools\")\n",
    "print(\"üîß Available tools:\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "d0535b4a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:34.526830Z",
     "iopub.status.busy": "2025-11-23T23:25:34.526484Z",
     "iopub.status.idle": "2025-11-23T23:25:34.533274Z",
     "shell.execute_reply": "2025-11-23T23:25:34.532179Z"
    },
    "papermill": {
     "duration": 0.014839,
     "end_time": "2025-11-23T23:25:34.535043",
     "exception": false,
     "start_time": "2025-11-23T23:25:34.520204",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Runner created.\n"
     ]
    }
   ],
   "source": [
    "# Test the booking agent\n",
    "runner = InMemoryRunner(agent=booking_agent)\n",
    "print(\"‚úÖ Runner created.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "69fa0cf2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:34.546982Z",
     "iopub.status.busy": "2025-11-23T23:25:34.546620Z",
     "iopub.status.idle": "2025-11-23T23:25:34.550715Z",
     "shell.execute_reply": "2025-11-23T23:25:34.549952Z"
    },
    "papermill": {
     "duration": 0.012205,
     "end_time": "2025-11-23T23:25:34.552251",
     "exception": false,
     "start_time": "2025-11-23T23:25:34.540046",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#response = await runner.run_debug(\" book a doctor\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "d5bf4f6a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:34.563897Z",
     "iopub.status.busy": "2025-11-23T23:25:34.563543Z",
     "iopub.status.idle": "2025-11-23T23:25:34.567994Z",
     "shell.execute_reply": "2025-11-23T23:25:34.566995Z"
    },
    "papermill": {
     "duration": 0.012619,
     "end_time": "2025-11-23T23:25:34.569891",
     "exception": false,
     "start_time": "2025-11-23T23:25:34.557272",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#response = await runner.run_debug(\"How to add this info\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "abf1bb9e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:34.581423Z",
     "iopub.status.busy": "2025-11-23T23:25:34.581132Z",
     "iopub.status.idle": "2025-11-23T23:25:35.869446Z",
     "shell.execute_reply": "2025-11-23T23:25:35.868178Z"
    },
    "papermill": {
     "duration": 1.296543,
     "end_time": "2025-11-23T23:25:35.871548",
     "exception": false,
     "start_time": "2025-11-23T23:25:34.575005",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      " ### Created new session: debug_session_id\n",
      "\n",
      "User > Kaykubad Dr. saynoor 2025/10/24 9.00AM skinissues\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:google_genai.types:Warning: there are non-text parts in the response: ['function_call'], returning concatenated text result from text parts. Check the full candidates.content.parts accessor to get the full model response.\n"
     ]
    }
   ],
   "source": [
    "response = await runner.run_debug(\"Kaykubad Dr. saynoor 2025/10/24 9.00AM skinissues\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "43ea5c56",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:35.883708Z",
     "iopub.status.busy": "2025-11-23T23:25:35.883419Z",
     "iopub.status.idle": "2025-11-23T23:25:35.892640Z",
     "shell.execute_reply": "2025-11-23T23:25:35.891726Z"
    },
    "papermill": {
     "duration": 0.017529,
     "end_time": "2025-11-23T23:25:35.894365",
     "exception": false,
     "start_time": "2025-11-23T23:25:35.876836",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import uuid\n",
    "from datetime import datetime\n",
    "\n",
    "# Fake medicine inventory (replace with database in real app)\n",
    "medicine_inventory = {\n",
    "    \"Paracetamol 500mg\": {\"price\": 5.0, \"stock\": 50},\n",
    "    \"Aspirin 300mg\": {\"price\": 8.0, \"stock\": 20},\n",
    "    \"Amoxicillin 250mg\": {\"price\": 15.0, \"stock\": 10},\n",
    "    \"Cetirizine 10mg\": {\"price\": 3.0, \"stock\": 40},\n",
    "}\n",
    "\n",
    "orders = []\n",
    "\n",
    "\n",
    "def book_medicine_online(customer_name: str,\n",
    "                         medicine_name: str,\n",
    "                         quantity: int,\n",
    "                         address: str,\n",
    "                         phone: str):\n",
    "    \"\"\"\n",
    "    Book/order medicine online with stock validation and 5% service charge.\n",
    "    \"\"\"\n",
    "\n",
    "    # Validate input\n",
    "    if quantity <= 0:\n",
    "        return {\"status\": \"error\", \"message\": \"Quantity must be greater than zero.\"}\n",
    "\n",
    "    if medicine_name not in medicine_inventory:\n",
    "        return {\"status\": \"error\", \"message\": f\"{medicine_name} not found in inventory.\"}\n",
    "\n",
    "    med = medicine_inventory[medicine_name]\n",
    "\n",
    "    # Stock check\n",
    "    if quantity > med[\"stock\"]:\n",
    "        return {\n",
    "            \"status\": \"error\",\n",
    "            \"message\": f\"Only {med['stock']} units of {medicine_name} available.\"\n",
    "        }\n",
    "\n",
    "    # Base price\n",
    "    base_price = quantity * med[\"price\"]\n",
    "\n",
    "    # Service charge 5%\n",
    "    service_charge = base_price * 0.05\n",
    "\n",
    "    # Final total\n",
    "    total_price = base_price + service_charge\n",
    "\n",
    "    # Update stock\n",
    "    medicine_inventory[medicine_name][\"stock\"] -= quantity\n",
    "\n",
    "    # Order data\n",
    "    order = {\n",
    "        \"order_id\": str(uuid.uuid4()),\n",
    "        \"customer_name\": customer_name,\n",
    "        \"medicine_name\": medicine_name,\n",
    "        \"quantity\": quantity,\n",
    "        \"base_price\": base_price,\n",
    "        \"service_charge_5_percent\": service_charge,\n",
    "        \"total_price\": total_price,\n",
    "        \"address\": address,\n",
    "        \"phone\": phone,\n",
    "        \"order_time\": datetime.now().isoformat()\n",
    "    }\n",
    "\n",
    "    orders.append(order)\n",
    "\n",
    "    return {\n",
    "        \"status\": \"success\",\n",
    "        \"message\": \"Medicine ordered successfully!\",\n",
    "        \"order\": order\n",
    "    }\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "1e0617e4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:35.906453Z",
     "iopub.status.busy": "2025-11-23T23:25:35.906077Z",
     "iopub.status.idle": "2025-11-23T23:25:35.912576Z",
     "shell.execute_reply": "2025-11-23T23:25:35.911399Z"
    },
    "papermill": {
     "duration": 0.014284,
     "end_time": "2025-11-23T23:25:35.914272",
     "exception": false,
     "start_time": "2025-11-23T23:25:35.899988",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{'status': 'success', 'message': 'Medicine ordered successfully!', 'order': {'order_id': '38305906-b49e-4f58-828c-e56d90d59386', 'customer_name': 'John Doe', 'medicine_name': 'Paracetamol 500mg', 'quantity': 3, 'base_price': 15.0, 'service_charge_5_percent': 0.75, 'total_price': 15.75, 'address': 'Dhaka, Bangladesh', 'phone': '017xxxxxxxx', 'order_time': '2025-11-23T23:25:35.907578'}}\n"
     ]
    }
   ],
   "source": [
    "# ---------- TEST ----------\n",
    "print(book_medicine_online(\n",
    "    \"John Doe\",\n",
    "    \"Paracetamol 500mg\",\n",
    "    3,\n",
    "    \"Dhaka, Bangladesh\",\n",
    "    \"017xxxxxxxx\"\n",
    "))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "89b89841",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:35.926001Z",
     "iopub.status.busy": "2025-11-23T23:25:35.925659Z",
     "iopub.status.idle": "2025-11-23T23:25:35.933451Z",
     "shell.execute_reply": "2025-11-23T23:25:35.932178Z"
    },
    "papermill": {
     "duration": 0.015693,
     "end_time": "2025-11-23T23:25:35.935086",
     "exception": false,
     "start_time": "2025-11-23T23:25:35.919393",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Runner created.\n"
     ]
    }
   ],
   "source": [
    "# booking agent with custom function tools\n",
    "medicbooking_agent = LlmAgent(\n",
    "    name=\"medicbooking_agent\",\n",
    "    model=Gemini(model=\"gemini-2.5-flash-lite\", retry_options=retry_config),\n",
    "    instruction=\"\"\"You are a smart booking agent assistant.\n",
    "\n",
    "    For medicine order conversion requests:\n",
    "    1. Use `book_medicine_online()` for booking\n",
    "    3. Check the \"status\" field in each tool's response for errors\n",
    "    4.If any tool returns status \"error\", explain the issue to the user clearly.\n",
    "    5. give the result json formet\n",
    "    6. ask everything and accept the data\n",
    "    6. after confirm the order give it json formet with its service charge result and suceessful message.\n",
    "    \"\"\",\n",
    "    tools=[book_medicine_online],\n",
    ")\n",
    "runner = InMemoryRunner(agent=medicbooking_agent)\n",
    "print(\"‚úÖ Runner created.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "2eddd5b7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:35.947008Z",
     "iopub.status.busy": "2025-11-23T23:25:35.946637Z",
     "iopub.status.idle": "2025-11-23T23:25:36.534253Z",
     "shell.execute_reply": "2025-11-23T23:25:36.532557Z"
    },
    "papermill": {
     "duration": 0.59584,
     "end_time": "2025-11-23T23:25:36.536177",
     "exception": false,
     "start_time": "2025-11-23T23:25:35.940337",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      " ### Created new session: debug_session_id\n",
      "\n",
      "User > how to order medicine\n",
      "medicbooking_agent > I can help you order medicine online. Please provide me with the following details:\n",
      "- Your name\n",
      "- Name of the medicine\n",
      "- Quantity\n",
      "- Your address\n",
      "- Your phone number\n"
     ]
    }
   ],
   "source": [
    "response = await runner.run_debug(\"how to order medicine\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "e1ced994",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:36.549500Z",
     "iopub.status.busy": "2025-11-23T23:25:36.548686Z",
     "iopub.status.idle": "2025-11-23T23:25:36.858985Z",
     "shell.execute_reply": "2025-11-23T23:25:36.857746Z"
    },
    "papermill": {
     "duration": 0.318693,
     "end_time": "2025-11-23T23:25:36.860676",
     "exception": false,
     "start_time": "2025-11-23T23:25:36.541983",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      " ### Continue session: debug_session_id\n",
      "\n",
      "User > turag Paracetamol 500mg 5pcs Dhaka 019888888\n",
      "medicbooking_agent > Could you please provide your name?\n"
     ]
    }
   ],
   "source": [
    "response = await runner.run_debug(\"turag Paracetamol 500mg 5pcs Dhaka 019888888\")\n",
    "                                            "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "0e4ee938",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:36.880482Z",
     "iopub.status.busy": "2025-11-23T23:25:36.880086Z",
     "iopub.status.idle": "2025-11-23T23:25:38.185503Z",
     "shell.execute_reply": "2025-11-23T23:25:38.184131Z"
    },
    "papermill": {
     "duration": 1.314071,
     "end_time": "2025-11-23T23:25:38.187376",
     "exception": false,
     "start_time": "2025-11-23T23:25:36.873305",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      " ### Continue session: debug_session_id\n",
      "\n",
      "User > confirm this\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "WARNING:google_genai.types:Warning: there are non-text parts in the response: ['function_call'], returning concatenated text result from text parts. Check the full candidates.content.parts accessor to get the full model response.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "medicbooking_agent > Yes, your order has been confirmed.\n",
      "\n",
      "Here is the summary of your order:\n",
      "- Order ID: 4f729b5b-6b93-4304-8ebd-b47196877870\n",
      "- Customer Name: turag\n",
      "- Medicine Name: Paracetamol 500mg\n",
      "- Quantity: 5\n",
      "- Address: Dhaka\n",
      "- Phone: 019888888\n",
      "- Base Price: 25\n",
      "- Service Charge (5%): 1.25\n",
      "- Total Price: 26.25\n",
      "\n",
      "Your order has been successfully placed. Thank you!\n"
     ]
    }
   ],
   "source": [
    "response = await runner.run_debug('confirm this')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "b0d08250",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:38.200916Z",
     "iopub.status.busy": "2025-11-23T23:25:38.199671Z",
     "iopub.status.idle": "2025-11-23T23:25:38.205879Z",
     "shell.execute_reply": "2025-11-23T23:25:38.205028Z"
    },
    "papermill": {
     "duration": 0.01455,
     "end_time": "2025-11-23T23:25:38.207449",
     "exception": false,
     "start_time": "2025-11-23T23:25:38.192899",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "medical_booking_order_agent = LlmAgent(\n",
    "    name=\"medical_booking_order_agent\",\n",
    "    model=Gemini(model=\"gemini-2.5-flash-lite\", retry_options=retry_config),\n",
    "    # Updated instruction\n",
    "    instruction=\"\"\"You are a smart doctor booking and medicine order assistant. You must strictly follow these steps and use the available tools.\n",
    "\n",
    "  For any doctor booking or medicine order conversion request:\n",
    "\n",
    "   1. for doctor booking: Use the book_doctor_appointment() tool to book the doctor for patient.\n",
    "   2. for medicine order : Use the book_medicine_online() tool to confirm the order.\n",
    "   3. Error Check: After each tool call, you must check the \"status\" field in the response. If the status is \"error\", you must stop and clearly explain the issue to the user.\n",
    "   4. Provide Detailed Breakdown: In your summary, you must:\n",
    "       * State the final result in json formet.\n",
    "       * Explain how the result was how it work, including:\n",
    "           * The fee percentage and the fee amount \n",
    "    \"\"\",\n",
    "    tools=[book_doctor_appointment,\n",
    "           book_medicine_online,\n",
    "        AgentTool(agent=iMedic),  # Using another agent as a tool!\n",
    "    ],\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "06448ea1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:38.219681Z",
     "iopub.status.busy": "2025-11-23T23:25:38.219386Z",
     "iopub.status.idle": "2025-11-23T23:25:38.226565Z",
     "shell.execute_reply": "2025-11-23T23:25:38.225373Z"
    },
    "papermill": {
     "duration": 0.015651,
     "end_time": "2025-11-23T23:25:38.228580",
     "exception": false,
     "start_time": "2025-11-23T23:25:38.212929",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Runner created.\n"
     ]
    }
   ],
   "source": [
    "runner = InMemoryRunner(agent=medical_booking_order_agent)\n",
    "print(\"‚úÖ Runner created.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "4ac2489c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:38.241360Z",
     "iopub.status.busy": "2025-11-23T23:25:38.240893Z",
     "iopub.status.idle": "2025-11-23T23:25:38.913480Z",
     "shell.execute_reply": "2025-11-23T23:25:38.912409Z"
    },
    "papermill": {
     "duration": 0.681227,
     "end_time": "2025-11-23T23:25:38.915314",
     "exception": false,
     "start_time": "2025-11-23T23:25:38.234087",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      " ### Created new session: debug_session_id\n",
      "\n",
      "User > what is your agent name?\n",
      "medical_booking_order_agent > My internal name is \"medical_booking_order_agent\".\n"
     ]
    }
   ],
   "source": [
    "response = await runner.run_debug(\"what is your agent name?\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "683033ae",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:38.929366Z",
     "iopub.status.busy": "2025-11-23T23:25:38.929053Z",
     "iopub.status.idle": "2025-11-23T23:25:38.933702Z",
     "shell.execute_reply": "2025-11-23T23:25:38.932593Z"
    },
    "papermill": {
     "duration": 0.014317,
     "end_time": "2025-11-23T23:25:38.935582",
     "exception": false,
     "start_time": "2025-11-23T23:25:38.921265",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#!adk create medical_booking_order_agent --model gemini-2.5-flash-lite --api_key $GOOGLE_API_KEY"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "ea7c50c3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:38.948212Z",
     "iopub.status.busy": "2025-11-23T23:25:38.947875Z",
     "iopub.status.idle": "2025-11-23T23:25:38.952431Z",
     "shell.execute_reply": "2025-11-23T23:25:38.951302Z"
    },
    "papermill": {
     "duration": 0.012976,
     "end_time": "2025-11-23T23:25:38.954112",
     "exception": false,
     "start_time": "2025-11-23T23:25:38.941136",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#url_prefix = get_adk_proxy_url()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "e25c0496",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-23T23:25:38.966874Z",
     "iopub.status.busy": "2025-11-23T23:25:38.966544Z",
     "iopub.status.idle": "2025-11-23T23:25:38.970605Z",
     "shell.execute_reply": "2025-11-23T23:25:38.969660Z"
    },
    "papermill": {
     "duration": 0.012649,
     "end_time": "2025-11-23T23:25:38.972567",
     "exception": false,
     "start_time": "2025-11-23T23:25:38.959918",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "#!adk web --url_prefix {url_prefix}"
   ]
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "none",
   "dataSources": [],
   "dockerImageVersionId": 31192,
   "isGpuEnabled": false,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.13"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 68.437433,
   "end_time": "2025-11-23T23:25:41.836430",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2025-11-23T23:24:33.398997",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
