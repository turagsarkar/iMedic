{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "776cfc4e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-22T07:09:53.276265Z",
     "iopub.status.busy": "2025-11-22T07:09:53.275969Z",
     "iopub.status.idle": "2025-11-22T07:09:53.469679Z",
     "shell.execute_reply": "2025-11-22T07:09:53.468688Z"
    },
    "papermill": {
     "duration": 0.198591,
     "end_time": "2025-11-22T07:09:53.471034",
     "exception": false,
     "start_time": "2025-11-22T07:09:53.272443",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Gemini API key setup complete.\n"
     ]
    }
   ],
   "source": [
    "import os\n",
    "from kaggle_secrets import UserSecretsClient\n",
    "\n",
    "try:\n",
    "    GOOGLE_API_KEY = UserSecretsClient().get_secret(\"GOOGLE_API_KEY\")\n",
    "    os.environ[\"GOOGLE_API_KEY\"] = GOOGLE_API_KEY\n",
    "    print(\"‚úÖ Gemini API key setup complete.\")\n",
    "except Exception as e:\n",
    "    print(\n",
    "        f\"üîë Authentication Error: Please make sure you have added 'GOOGLE_API_KEY' to your Kaggle secrets. Details: {e}\"\n",
    "    )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "dd28f57e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-22T07:09:53.476075Z",
     "iopub.status.busy": "2025-11-22T07:09:53.475835Z",
     "iopub.status.idle": "2025-11-22T07:10:49.034300Z",
     "shell.execute_reply": "2025-11-22T07:10:49.033386Z"
    },
    "papermill": {
     "duration": 55.564398,
     "end_time": "2025-11-22T07:10:49.037494",
     "exception": false,
     "start_time": "2025-11-22T07:09:53.473096",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ ADK components imported successfully.\n"
     ]
    }
   ],
   "source": [
    "from google.adk.agents import Agent\n",
    "from google.adk.models.google_llm import Gemini\n",
    "from google.adk.runners import InMemoryRunner\n",
    "from google.adk.tools import google_search\n",
    "from google.genai import types\n",
    "\n",
    "print(\"‚úÖ ADK components imported successfully.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "264ba7e0",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-22T07:10:49.043711Z",
     "iopub.status.busy": "2025-11-22T07:10:49.042281Z",
     "iopub.status.idle": "2025-11-22T07:10:50.047330Z",
     "shell.execute_reply": "2025-11-22T07:10:50.046321Z"
    },
    "papermill": {
     "duration": 1.009698,
     "end_time": "2025-11-22T07:10:50.049057",
     "exception": false,
     "start_time": "2025-11-22T07:10:49.039359",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Helper functions defined.\n"
     ]
    }
   ],
   "source": [
    "# Define helper functions that will be reused throughout the notebook\n",
    "\n",
    "from IPython.core.display import display, HTML\n",
    "from jupyter_server.serverapp import list_running_servers\n",
    "\n",
    "\n",
    "# Gets the proxied URL in the Kaggle Notebooks environment\n",
    "def get_adk_proxy_url():\n",
    "    PROXY_HOST = \"https://kkb-production.jupyter-proxy.kaggle.net\"\n",
    "    ADK_PORT = \"8000\"\n",
    "\n",
    "    servers = list(list_running_servers())\n",
    "    if not servers:\n",
    "        raise Exception(\"No running Jupyter servers found.\")\n",
    "\n",
    "    baseURL = servers[0][\"base_url\"]\n",
    "\n",
    "    try:\n",
    "        path_parts = baseURL.split(\"/\")\n",
    "        kernel = path_parts[2]\n",
    "        token = path_parts[3]\n",
    "    except IndexError:\n",
    "        raise Exception(f\"Could not parse kernel/token from base URL: {baseURL}\")\n",
    "\n",
    "    url_prefix = f\"/k/{kernel}/{token}/proxy/proxy/{ADK_PORT}\"\n",
    "    url = f\"{PROXY_HOST}{url_prefix}\"\n",
    "\n",
    "    styled_html = f\"\"\"\n",
    "    <div style=\"padding: 15px; border: 2px solid #f0ad4e; border-radius: 8px; background-color: #fef9f0; margin: 20px 0;\">\n",
    "        <div style=\"font-family: sans-serif; margin-bottom: 12px; color: #333; font-size: 1.1em;\">\n",
    "            <strong>‚ö†Ô∏è IMPORTANT: Action Required</strong>\n",
    "        </div>\n",
    "        <div style=\"font-family: sans-serif; margin-bottom: 15px; color: #333; line-height: 1.5;\">\n",
    "            The ADK web UI is <strong>not running yet</strong>. You must start it in the next cell.\n",
    "            <ol style=\"margin-top: 10px; padding-left: 20px;\">\n",
    "                <li style=\"margin-bottom: 5px;\"><strong>Run the next cell</strong> (the one with <code>!adk web ...</code>) to start the ADK web UI.</li>\n",
    "                <li style=\"margin-bottom: 5px;\">Wait for that cell to show it is \"Running\" (it will not \"complete\").</li>\n",
    "                <li>Once it's running, <strong>return to this button</strong> and click it to open the UI.</li>\n",
    "            </ol>\n",
    "            <em style=\"font-size: 0.9em; color: #555;\">(If you click the button before running the next cell, you will get a 500 error.)</em>\n",
    "        </div>\n",
    "        <a href='{url}' target='_blank' style=\"\n",
    "            display: inline-block; background-color: #1a73e8; color: white; padding: 10px 20px;\n",
    "            text-decoration: none; border-radius: 25px; font-family: sans-serif; font-weight: 500;\n",
    "            box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: all 0.2s ease;\">\n",
    "            Open ADK Web UI (after running cell below) ‚Üó\n",
    "        </a>\n",
    "    </div>\n",
    "    \"\"\"\n",
    "\n",
    "    display(HTML(styled_html))\n",
    "\n",
    "    return url_prefix\n",
    "\n",
    "\n",
    "print(\"‚úÖ Helper functions defined.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "ff06b6d9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-22T07:10:50.054990Z",
     "iopub.status.busy": "2025-11-22T07:10:50.054480Z",
     "iopub.status.idle": "2025-11-22T07:10:50.059412Z",
     "shell.execute_reply": "2025-11-22T07:10:50.058589Z"
    },
    "papermill": {
     "duration": 0.00988,
     "end_time": "2025-11-22T07:10:50.061023",
     "exception": false,
     "start_time": "2025-11-22T07:10:50.051143",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "retry_config=types.HttpRetryOptions(\n",
    "    attempts=5,  # Maximum retry attempts\n",
    "    exp_base=7,  # Delay multiplier\n",
    "    initial_delay=1, # Initial delay before first retry (in seconds)\n",
    "    http_status_codes=[429, 500, 503, 504] # Retry on these HTTP errors\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "cf954d59",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-22T07:10:50.066962Z",
     "iopub.status.busy": "2025-11-22T07:10:50.066316Z",
     "iopub.status.idle": "2025-11-22T07:10:50.072618Z",
     "shell.execute_reply": "2025-11-22T07:10:50.071702Z"
    },
    "papermill": {
     "duration": 0.010948,
     "end_time": "2025-11-22T07:10:50.074307",
     "exception": false,
     "start_time": "2025-11-22T07:10:50.063359",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Root Agent defined.\n"
     ]
    }
   ],
   "source": [
    "root_agent = Agent(\n",
    "    name=\"iMedic\",\n",
    "    model=Gemini(\n",
    "        model=\"gemini-2.5-flash-lite\",\n",
    "        retry_options=retry_config\n",
    "    ),\n",
    "    description=\"A simple agent that can answer general questions.\",\n",
    "    instruction=\"You are a helpful assistant. Use Google Search for current info or if unsure.\",\n",
    "    tools=[google_search],\n",
    ")\n",
    "\n",
    "print(\"‚úÖ Root Agent defined.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "2b438d7c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-22T07:10:50.081539Z",
     "iopub.status.busy": "2025-11-22T07:10:50.081078Z",
     "iopub.status.idle": "2025-11-22T07:10:50.088794Z",
     "shell.execute_reply": "2025-11-22T07:10:50.087325Z"
    },
    "papermill": {
     "duration": 0.014038,
     "end_time": "2025-11-22T07:10:50.090582",
     "exception": false,
     "start_time": "2025-11-22T07:10:50.076544",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Runner created.\n"
     ]
    }
   ],
   "source": [
    "runner = InMemoryRunner(agent=root_agent)\n",
    "\n",
    "print(\"‚úÖ Runner created.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "7f549aba",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-11-22T07:10:50.096276Z",
     "iopub.status.busy": "2025-11-22T07:10:50.095996Z",
     "iopub.status.idle": "2025-11-22T07:10:51.296037Z",
     "shell.execute_reply": "2025-11-22T07:10:51.295070Z"
    },
    "papermill": {
     "duration": 1.204453,
     "end_time": "2025-11-22T07:10:51.297497",
     "exception": false,
     "start_time": "2025-11-22T07:10:50.093044",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      " ### Created new session: debug_session_id\n",
      "\n",
      "User > Medical terms mean?\n",
      "iMedic > To understand what medical terms mean, I need you to provide me with the specific medical terms you're interested in. Please list them, and I'll do my best to explain them to you.\n"
     ]
    }
   ],
   "source": [
    "response = await runner.run_debug(\n",
    "    \"Medical terms mean?\"\n",
    ")"
   ]
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "none",
   "dataSources": [],
   "dockerImageVersionId": 31192,
   "isGpuEnabled": false,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.13"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 66.895898,
   "end_time": "2025-11-22T07:10:54.218495",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2025-11-22T07:09:47.322597",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
